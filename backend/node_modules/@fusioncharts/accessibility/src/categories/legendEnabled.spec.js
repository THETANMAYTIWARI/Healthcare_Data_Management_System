import FusionCharts from "../../../fusioncharts/core/index";
import { setup, CONTAINER_ID } from "../../../../dev-tests/viz/utitilies";
import Mscolumn2d from "../../../fusioncharts/viz/mscolumn2d";

FusionCharts.addDep(Mscolumn2d);

// Unit-test case to test the tab 
describe('Unit Test Case for Tab index checking ', function(){
    let chartObj,
    chartData={
        type: 'mscolumn2d',
        renderAt: CONTAINER_ID,
        width: '500',
        height: '300',
        dataFormat: 'json',
        dataSource: {
          "chart": {
            "caption": "Comparison of Quarterly Revenue",
            "subCaption": "Harry's SuperMart",
            "xAxisname": "Quarter",
            "yAxisName": "Revenues (In USD)",
            "numberPrefix": "$",
            "theme": "fusion",
            "accessibility": "1"
          },
          "categories": [{
            "category": [{
              "label": "Q1"
            }, {
              "label": "Q2"
            }, {
              "label": "Q3"
            }, {
              "label": "Q4"
            }]
          }],
          "dataset": [{
            "seriesname": "Previous Year",
            "data": [{
              "value": "10000"
            }, {
              "value": "11500"
            }, {
              "value": "12500"
            }, {
              "value": "15000"
            }]
          }, {
            "seriesname": "Current Year",
            "data": [{
              "value": "25400"
            }, {
              "value": "29800"
            }, {
              "value": "21800"
            }, {
              "value": "26800"
            }]
          }]
        }
      }
    beforeEach(() => {
        chartObj = setup(FusionCharts, chartData);
      });
    
      afterEach(() => {
        chartObj && !chartObj.disposed && chartObj.dispose();
      });

    it('testing the Tab Index of Plots ', function(done){
        chartObj.addEventListener('renderComplete', function () {
               let  gTags=document.querySelectorAll('g'),
               expectedValue=2, 
               count=0,
               expectedVisibility='none';
               chartObj.apiInstance.getChildren("legend")[0]
               .getChildren()["legendItem"][0]
              .fireEvent('fc-click');
                setTimeout(function(){
                    gTags.forEach(container => {
                    let itemContainerClass = Array.from(container.classList).find(value => value.includes('plot-group'));    
                    if (itemContainerClass) {
                       count++;
                       let pathItem = container.querySelector('rect'); 
                        if (pathItem) {        
                            if(count==1){
                                let rectVisibility=pathItem.style.display;
                                expect(rectVisibility).toBe(expectedVisibility);
                            }else{
                                let rectItemTabIndex=rectContainer.getAttribute('tabindex');
                                expect(rectItemTabIndex).toBe(expectedValue); 
                            }
                        } 
                    }
                });     
            },1000);
            done();
        });
        chartObj.render();
    });
});